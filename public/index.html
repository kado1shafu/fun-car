<!DOCTYPE html>
<html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#005c89">
    <title>Управление</title>
    <!-- <link rel="stylesheet" href="bootstrap/bootstrap.min.css" type="text/css" /> -->
</head>
<body>
<style>
@font-face {
  font-family: 'Agency FB';
  src: url('8711.ttf') format('truetype');
}

* {
    user-select: none;
    font: 20px 'Agency FB', sans-serif;
}

body {
  margin: 0;
  padding: 0;
  /*margin-top: 20px;*/
  max-width: 1024px;
  margin-left: auto;
  margin-right: auto;
}

#buttons {
  position: relative;
  border: solid 1px #aaa;
  display: inline-block;
  width: 100%;
  border-radius: 10px;
  height: 50px;
  overflow: hidden;
  margin-bottom: 20px;
  box-sizing: border-box;
}

.button {
  display: inline-block;
  background: #ccc;
  color: black;
  height: 50px;
  width: 33%;
  margin: 0;
  margin-right: -3px;
  text-align: center;
  line-height: 45px;
  font-size: 25px;
  cursor: pointer;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.button:hover {
  background: #eee;
}

.button:active {
  background: #ddd;
}

.button.active {
  color: white;
  background: #888;
}

.button:nth-child(2) {
  width: 34%;
  border-left: solid 1px #aaa;
  border-right: solid 1px #aaa;
}

.highlight {
  display: none;
}

.highlight.active {
  display: block;
}


.app {
  position: absolute;
  width: 100%;
  height: 100%;
  left: 0;
  background: #07222d;
}

.zone {
    display: none;
    position: absolute;
    width: 100%;
    height: 100%;
    left: 0;
}

.zone.active {
  display: block;
}

.footer {
  width: 100px;
  height: 100px;
}

.log {
  position: absolute;
}

#chat {
  max-height: 200px;
  max-width: 200px;
  overflow-y: auto;
  position: absolute;
  top: 0;
  right: 0;
  color: #3df7fb;
}
#ws-indicator {
    position: fixed;
    top: 8px;
    left: 8px;
    width: 10px;
    height: 10px;
    border-radius: 10px;
    background-color: grey;
    z-index: 1030;
}

#ws-indicator.on { background-color: #39bdc1; }
#ws-indicator.warn { background-color: orange; }

/* Arc Reactor */
ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

#arc_container {
  /*position: fixed;
  width: 100%;
  height: 100%;*/
  /*z-index: -1;*/
}


.arc_reactor {
  /*position: relative;*/
  /*top: 50%;*/
  /*margin-top: -60px;*/
  margin-left: auto;
  margin-right: auto;
  width: 120px;
  height: 120px;
  border-radius: 50%;
  box-shadow: 0px 0px 50px 15px rgba(2, 255, 255, 0.3), inset 0px 0px 50px 15px rgba(2, 255, 255, 0.3);
}

#widgets {
  position: absolute;
  top: 30px;
  right: 30px;
  width: 50%;
  height: 200px;

  display: flex;
  flex-wrap: wrap;
  flex-direction: row;
  justify-content: space-between;
  align-items: stretch;
}

.circles-text {
  -moz-border-radius: 50%;
  -webkit-border-radius: 50%;
  border-radius: 50%;
  transform: rotateZ(0deg);
  transition: box-shadow 3s ease;
  text-align: center;
  line-height: 100px;
  box-shadow: 0px 0px 30px rgba(2, 254, 255, 0.8);
}

#joystick-control {
    position: absolute;
    width: 100%;
    /*height: 30%;*/
    bottom: 20%;

    display:flex;
   flex-wrap:wrap;
   flex-direction:row;
   justify-content:flex-start;
   align-items:stretch;
}

#left-joystick, #right-joystick {
  flex: 1 300px;
  min-width: 0;
}

#left-joystick {
  position: relative
  /*position: absolute;*/
  /*top: 70%;*/
  /*left: 15%;*/
}

#right-joystick {
  position: relative
  /*position: absolute;*/
  /*top: 70%;*/
  /*right: 15%;*/
}

.case_container {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  /*position: absolute;
  margin-left: 20px;
  margin-top: 20px;*/
}

.core2 {
  background: #cedce0;
  width: 110px;
  height: 110px;
  -moz-border-radius: 50%;
  -webkit-border-radius: 50%;
  border-radius: 50%;
  border: 5px solid rgba(2, 255, 255, 0.15);
  animation: flicker2 0.2s infinite;
  margin-left: auto;
  margin-right: auto;
  margin-top: 40px;
}

.e7 {
  width: 95.25%;
  height: 95.25%;
  left: 2.5475%;
  right: 2.5475%;
  border: 6px solid transparent;
  background: transparent;
  -moz-border-radius: 50%;
  -webkit-border-radius: 50%;
  border-radius: 50%;
  transform: rotateZ(0deg);
  transition: box-shadow 3s ease;
  text-align: center;
  line-height: 100px;
}

.marks li {
  display: block;
  width: 2px;
  height: 10px;
  background: rgba(2, 254, 255, 0.8);
  position: absolute;
  /*margin-left: 105px;
  margin-top: -110px;*/
  margin-left: 59px;
  margin-top: -65px;
  /*margin-left: -2px;
  margin-top: -5px;*/
  animation: colour_ease2 3s infinite ease-in-out;
}

@keyframes colour_ease2 {
  0% {
    background: #02feff;
  }
  50% {
    background: rgba(2, 254, 255, 0.3);
  }
  100% {
    background: #02feff;
  }
}
.marks li:first-child {
  transform: rotate(6deg) translateY(60px);
}

.marks li:nth-child(2) {
  transform: rotate(12deg) translateY(60px);
}

.marks li:nth-child(3) {
  transform: rotate(18deg) translateY(60px);
}

.marks li:nth-child(4) {
  transform: rotate(24deg) translateY(60px);
}

.marks li:nth-child(5) {
  transform: rotate(30deg) translateY(60px);
}

.marks li:nth-child(6) {
  transform: rotate(36deg) translateY(60px);
}

.marks li:nth-child(7) {
  transform: rotate(42deg) translateY(60px);
}

.marks li:nth-child(8) {
  transform: rotate(48deg) translateY(60px);
}

.marks li:nth-child(9) {
  transform: rotate(54deg) translateY(60px);
}

.marks li:nth-child(10) {
  transform: rotate(60deg) translateY(60px);
}

.marks li:nth-child(11) {
  transform: rotate(66deg) translateY(60px);
}

.marks li:nth-child(12) {
  transform: rotate(72deg) translateY(60px);
}

.marks li:nth-child(13) {
  transform: rotate(78deg) translateY(60px);
}

.marks li:nth-child(14) {
  transform: rotate(84deg) translateY(60px);
}

.marks li:nth-child(15) {
  transform: rotate(90deg) translateY(60px);
}

.marks li:nth-child(16) {
  transform: rotate(96deg) translateY(60px);
}

.marks li:nth-child(17) {
  transform: rotate(102deg) translateY(60px);
}

.marks li:nth-child(18) {
  transform: rotate(108deg) translateY(60px);
}

.marks li:nth-child(19) {
  transform: rotate(114deg) translateY(60px);
}

.marks li:nth-child(20) {
  transform: rotate(120deg) translateY(60px);
}

.marks li:nth-child(21) {
  transform: rotate(126deg) translateY(60px);
}

.marks li:nth-child(22) {
  transform: rotate(132deg) translateY(60px);
}

.marks li:nth-child(23) {
  transform: rotate(138deg) translateY(60px);
}

.marks li:nth-child(24) {
  transform: rotate(144deg) translateY(60px);
}

.marks li:nth-child(25) {
  transform: rotate(150deg) translateY(60px);
}

.marks li:nth-child(26) {
  transform: rotate(156deg) translateY(60px);
}

.marks li:nth-child(27) {
  transform: rotate(162deg) translateY(60px);
}

.marks li:nth-child(28) {
  transform: rotate(168deg) translateY(60px);
}

.marks li:nth-child(29) {
  transform: rotate(174deg) translateY(60px);
}

.marks li:nth-child(30) {
  transform: rotate(180deg) translateY(60px);
}

.marks li:nth-child(31) {
  transform: rotate(186deg) translateY(60px);
}

.marks li:nth-child(32) {
  transform: rotate(192deg) translateY(60px);
}

.marks li:nth-child(33) {
  transform: rotate(198deg) translateY(60px);
}

.marks li:nth-child(34) {
  transform: rotate(204deg) translateY(60px);
}

.marks li:nth-child(35) {
  transform: rotate(210deg) translateY(60px);
}

.marks li:nth-child(36) {
  transform: rotate(216deg) translateY(60px);
}

.marks li:nth-child(37) {
  transform: rotate(222deg) translateY(60px);
}

.marks li:nth-child(38) {
  transform: rotate(228deg) translateY(60px);
}

.marks li:nth-child(39) {
  transform: rotate(234deg) translateY(60px);
}

.marks li:nth-child(40) {
  transform: rotate(240deg) translateY(60px);
}

.marks li:nth-child(41) {
  transform: rotate(246deg) translateY(60px);
}

.marks li:nth-child(42) {
  transform: rotate(252deg) translateY(60px);
}

.marks li:nth-child(43) {
  transform: rotate(258deg) translateY(60px);
}

.marks li:nth-child(44) {
  transform: rotate(264deg) translateY(60px);
}

.marks li:nth-child(45) {
  transform: rotate(270deg) translateY(60px);
}

.marks li:nth-child(46) {
  transform: rotate(276deg) translateY(60px);
}

.marks li:nth-child(47) {
  transform: rotate(282deg) translateY(60px);
}

.marks li:nth-child(48) {
  transform: rotate(288deg) translateY(60px);
}

.marks li:nth-child(49) {
  transform: rotate(294deg) translateY(60px);
}

.marks li:nth-child(50) {
  transform: rotate(300deg) translateY(60px);
}

.marks li:nth-child(51) {
  transform: rotate(306deg) translateY(60px);
}

.marks li:nth-child(52) {
  transform: rotate(312deg) translateY(60px);
}

.marks li:nth-child(53) {
  transform: rotate(318deg) translateY(60px);
}

.marks li:nth-child(54) {
  transform: rotate(324deg) translateY(60px);
}

.marks li:nth-child(55) {
  transform: rotate(330deg) translateY(60px);
}

.marks li:nth-child(56) {
  transform: rotate(336deg) translateY(60px);
}

.marks li:nth-child(57) {
  transform: rotate(342deg) translateY(60px);
}

.marks li:nth-child(58) {
  transform: rotate(348deg) translateY(60px);
}

.marks li:nth-child(59) {
  transform: rotate(354deg) translateY(60px);
}

.marks li:nth-child(60) {
  transform: rotate(360deg) translateY(60px);
}

body {
  background: black;
  color: #02feff;
}

#date_time {
  display: none;
  margin-left: 30px;
  margin-top: 30px;
  width: 200px;
  height: 200px;
}

#time {
  margin-left: 110px;
  position: fixed;
  background: rgba(6, 34, 45, 0.85);
  line-height: 0;
}

#date {
  position: fixed;
  margin-top: 20px;
  background: rgba(6, 34, 45, 0.85);
}

@media (min-width: 768px) {
    #date_time {
      display: block;
    }
}

.core {
  background: #cedce0;
  width: 100px;
  height: 100px;
  -moz-border-radius: 50%;
  -webkit-border-radius: 50%;
  border-radius: 50%;
  border: 10px rgba(2, 255, 255, 0.15) solid;
  animation: flicker 0.2s infinite;
  margin-left: auto;
  margin-right: auto;
  margin-top: 40px;
}

.core2 {
  background: #cedce0;
  width: 100px;
  height: 100px;
  -moz-border-radius: 50%;
  -webkit-border-radius: 50%;
  border-radius: 50%;
  border: 10px rgba(2, 255, 255, 0.15) solid;
  animation: flicker2 0.2s infinite;
  margin-left: auto;
  margin-right: auto;
  margin-top: 40px;
}

.big_core {
  background: #cedce0;
  width: 200px;
  height: 200px;
  -moz-border-radius: 50%;
  -webkit-border-radius: 50%;
  border-radius: 50%;
  border: 10px rgba(2, 255, 255, 0.15) solid;
  animation: big_flicker 0.2s infinite;
}

.c_ease {
  animation: colour_ease 3s infinite ease-in-out;
}

.counterspin5 {
  animation: rotate_anti 5s linear infinite;
}

.counterspin4 {
  animation: rotate_anti 4s linear infinite;
}

.semi_arc {
  width: 100px;
  height: 100px;
  border: 2px solid #02feff;
  background: rgba(2, 254, 255, 0.2);
  -moz-border-radius: 50%;
  -webkit-border-radius: 50%;
  border-radius: 50%;
  transform: rotateZ(0deg);
  transition: box-shadow 3s ease;
  text-align: center;
  line-height: 100px;
  box-shadow: 0px 0px 30px rgba(2, 254, 255, 0.8);
}


.semi_arc_2 {
  content: "";
  position: absolute;
  width: 94%;
  height: 94%;
  left: 3%;
  top: 3%;
  border: 5px solid #02feff;
  -moz-border-radius: 50%;
  -webkit-border-radius: 50%;
  border-radius: 50%;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  animation: rotate 4s linear infinite;
  text-align: center;
  line-height: 129px;
}

.semi_arc_2:after {
  content: "";
  position: absolute;
  width: 94%;
  height: 94%;
  left: 3%;
  top: 3%;
  border: 4px solid #02feff;
  -moz-border-radius: 50%;
  -webkit-border-radius: 50%;
  border-radius: 50%;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  animation: rotate_anti 2s linear infinite;
}

.semi_arc_3 {
  content: "";
  position: absolute;
  width: 94%;
  height: 94%;
  left: 3%;
  top: 3%;
  border: 5px solid #02feff;
  -moz-border-radius: 50%;
  -webkit-border-radius: 50%;
  border-radius: 50%;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  animation: rotate 4s linear infinite;
  text-align: center;
  line-height: 129px;
}

.arc {
  width: 100px;
  height: 100px;
  border: 2px solid #02feff;
  background: rgba(2, 254, 255, 0.2);
  -moz-border-radius: 50%;
  -webkit-border-radius: 50%;
  border-radius: 50%;
  -moz-transform: rotateY(-30deg) translateZ(-200px);
  -ms-transform: rotateY(-30deg) translateZ(-200px);
  -webkit-transform: rotateY(-30deg) translateZ(-200px);
  transform: rotateY(-30deg) translateZ(-200px);
  transform: rotateZ(0deg);
  transition: box-shadow 3s ease;
  text-align: center;
  line-height: 100px;
  box-shadow: 0px 0px 30px rgba(2, 254, 255, 0.8);
}

.arc:after {
  content: "";
  position: absolute;
  width: 94%;
  height: 94%;
  left: 3%;
  top: 3%;
  border: 4px solid #02feff;
  -moz-border-radius: 50%;
  -webkit-border-radius: 50%;
  border-radius: 50%;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  animation: rotate 4s linear infinite;
}

.e1:after {
  border-color: rgba(2, 255, 255, 0.6);
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
}

.e2:after {
  border-color: rgba(2, 255, 255, 0.6);
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-bottom: 5px solid transparent;
}

.e3 {
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  animation: rotate 5s linear infinite;
}

.e3:after {
  border-color: rgba(2, 255, 255, 0.6);
  border-top: 5px solid transparent;
  border-bottom: 5px solid transparent;
}

.e4 {
  width: 150px;
  height: 150px;
}

.e4_1 {
  border-color: rgba(2, 255, 255, 0.3);
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
}

.e4_1:after {
  border-color: rgba(2, 255, 255, 0.6);
  border-top: 4px solid transparent;
  border-bottom: 4px solid transparent;
}

.e5 {
  width: 200px;
  height: 200px;
}

.e5_1 {
  color: rgba(2, 255, 255, 0.15);
  border: 2px solid;
  border-left: 2px solid transparent;
  animation: rotate 5s linear infinite;
}

.e5_2 {
  color: rgba(2, 255, 255, 0.7);
  border: 4px solid;
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  animation: rotate_anti 4s linear infinite;
}

.e5_3 {
  color: rgba(2, 255, 255, 0.5);
  border: 2px solid;
  border-left: 2px solid transparent;
  border-right: 2px solid transparent;
  animation: rotate 3s linear infinite;
}

.e5_4 {
  color: rgba(2, 255, 255, 0.15);
  border: 4px solid;
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-bottom: 4px solid transparent;
  animation: rotate_anti 2s linear infinite;
}

.e6 {
  border-color: transparent;
  background: rgba(255, 255, 255, 0);
  width: 200px;
  height: 200px;
}

@keyframes rotate {
  0% {
    transform: rotateZ(0deg);
  }
  100% {
    transform: rotateZ(360deg);
  }
}
@keyframes rotate_anti {
  0% {
    transform: rotateZ(360deg);
  }
  100% {
    transform: rotateZ(0deg);
  }
}
@keyframes colour_ease {
  0% {
    border-color: #02feff;
  }
  50% {
    border-color: rgba(2, 254, 255, 0.5);
  }
  100% {
    border-color: #02feff;
  }
}
@keyframes flicker {
  0% {
    box-shadow: 0px 0px 16px 8px rgba(150, 255, 255, 0.5), inset 0px 1px 4px 2px rgba(21, 211, 233, 0.3);
  }
  40% {
    box-shadow: 0px 0px 16px 8px rgba(150, 255, 255, 0.5), inset 0px 1px 4px 2px rgba(21, 211, 233, 0.3);
  }
  50% {
    box-shadow: 0px 0px 16px 6px rgba(150, 255, 255, 0.5), inset 0px 1px 100px 2px rgba(21, 211, 233, 0.3);
  }
  60% {
    box-shadow: 0px 0px 16px 8px rgba(150, 255, 255, 0.5), inset 0px 1px 4px 2px rgba(21, 211, 233, 0.3);
  }
  100% {
    box-shadow: 0px 0px 16px 8px rgba(150, 255, 255, 0.5), inset 0px 1px 4px 2px rgba(21, 211, 233, 0.3);
  }
}
@keyframes flicker2 {
  0% {
    box-shadow: 0px 0px 60px 25px rgba(150, 255, 255, 0.5), inset 0px 1px 4px 2px rgba(21, 211, 233, 0.3);
  }
  40% {
    box-shadow: 0px 0px 60px 25px rgba(150, 255, 255, 0.5), inset 0px 1px 4px 2px rgba(21, 211, 233, 0.3);
  }
  50% {
    box-shadow: 0px 0px 50px 17px rgba(150, 255, 255, 0.5), inset 0px 1px 100px 2px rgba(21, 211, 233, 0.3);
  }
  60% {
    box-shadow: 0px 0px 60px 25px rgba(150, 255, 255, 0.5), inset 0px 1px 4px 2px rgba(21, 211, 233, 0.3);
  }
  100% {
    box-shadow: 0px 0px 60px 25px rgba(150, 255, 255, 0.5), inset 0px 1px 4px 2px rgba(21, 211, 233, 0.3);
  }
}
@keyframes big_flicker {
  0% {
    box-shadow: 0px 0px 40px 20px rgba(150, 255, 255, 0.5), inset 0px 1px 30px 15px rgba(21, 211, 233, 0.3);
  }
  40% {
    box-shadow: 0px 0px 40px 20px rgba(150, 255, 255, 0.5), inset 0px 1px 30px 15px rgba(21, 211, 233, 0.3);
  }
  50% {
    box-shadow: 0px 0px 35px 17px rgba(150, 255, 255, 0.5), inset 0px 1px 50px 40px rgba(21, 211, 233, 0.3);
  }
  60% {
    box-shadow: 0px 0px 40px 20px rgba(150, 255, 255, 0.5), inset 0px 1px 30px 15px rgba(21, 211, 233, 0.3);
  }
  100% {
    box-shadow: 0px 0px 40px 20px rgba(150, 255, 255, 0.5), inset 0px 1px 30px 15px rgba(21, 211, 233, 0.3);
  }
}

</style>
<body>
<div class="container">
  <div id="ws-indicator"></div>
  <main class="app">

    <div id="date_time">
      <div id="date" class="semi_arc e4">
        <div class="semi_arc_2 e4_1">
          <div class="counterspin4"></div>
        </div>
          <div id="current-day" style="font-size: 40px; margin-top: 25px;">04</div>
          <div id="current-month" style="font-size: 25px;">January</div>
      </div>

      <div id="time" class="arc e1">
          <div id="current-time" style="font-size: 30px; margin-top: 25px; margin-left: 3px;margin-top: 29px;">23:41</div>
      </div>
    </div>

    <!-- <pre class="log"></pre> -->
    <!-- <div id="chat"></div> -->

    <div id='widgets'>
      <!-- <canvas width=240 height=200 id="widget-mem"></canvas> -->
      <!-- <div id="mem-circle" data-animation="1" data-animationStep="5" data-percent="58"></div> -->
      <div>CPU <div class="circle" id="cpu-circle"></div></div>
      <div>MEMORY <div class="circle" id="mem-circle"></div></div>
      <div>VOLTAGE <div class="circle" id="vin-circle"></div></div>
    </div>

    <div id="joystick-control">
      <div id="left-joystick">
        <!-- https://codepen.io/FlyingEmu/ -->
        <div class="arc_reactor">
          <div class="case_container">
            <div class="e7">
              <div class="semi_arc_3 e5_1">
                <div class="semi_arc_3 e5_2">
                  <div class="semi_arc_3 e5_3">
                  </div>
                </div>
              </div>
              <!-- <div class="core2"></div> -->

            </div>
            <ul class="marks">
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
            </ul>
              <div id="position-joystick"  class="zone static active" style="touch-action: none;"></div>
          </div>
        </div>
      </div>

      <div id="right-joystick">
        <!-- https://codepen.io/FlyingEmu/pen/tclyg -->
        <div class="arc_reactor">
          <div class="case_container">
            <div class="e7">
              <div class="semi_arc_3 e5_1">
                <div class="semi_arc_3 e5_2">
                  <div class="semi_arc_3 e5_3">
                  </div>
                </div>
              </div>
            </div>
            <ul class="marks">
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
              <li></li><li></li><li></li><li></li><li></li><li></li>
            </ul>
            <div id="arm-joystick"  class="zone static active" style="touch-action: none;"></div>
          </div>
        </div>
      </div>
    </div>

  </main>
</div>

<script src="js/jquery.min.js"></script>
<script src="js/nipplejs.min.js"></script>
<script src="js/circles.min.js"></script>
<script>
function Socket(userSettings) {
  var ws_ctx = this,
    output = $("#chat"),
    indicator = $("#ws-indicator"),
    defaultSettings = {
      chatOpen: false,
      uri: "ws://" + window.location.hostname + "/ws/"
    },
    settings = Object.assign({}, defaultSettings, userSettings),
    websocket,
    testWebsocket = null;

  function onRepeat() {
    if (testWebsocket) {
      return;
    }

    setTimeout(function() {
      indicator.addClass("warn");
      testWebsocket = createWebsocket();
    }, 3000);
  }

  function onRepeatSuccess() {
    websocket = testWebsocket;
    testWebsocket = null;
    indicator.removeClass("warn");
    settings.onOpen && settings.onOpen();
  }

  function createWebsocket() {
    var newWebsocket = new WebSocket(settings.uri);
    newWebsocket.onopen = function(evt) {
      onOpen(evt);
    };
    newWebsocket.onclose = function(evt) {
      onClose(evt);
    };
    newWebsocket.onmessage = function(evt) {
      onMessage(evt);
    };
    newWebsocket.onerror = function(evt) {
      onError(evt);
    };
    return newWebsocket;
  }

  ws_ctx.doSend = function(message) {
    writeToScreen("SENT: " + JSON.stringify(message));
    var isOpen = websocket.readyState === 1;
    isOpen && websocket.send(JSON.stringify(message));
  };

  function onOpen(evt) {
    window.onbeforeunload = function() {
      websocket.close();
    };
    indicator.addClass("on");
    writeToScreen("CONNECTED");
    testWebsocket && onRepeatSuccess();
    settings.onOpen && settings.onOpen();
  }

  function onClose(evt) {
    indicator.removeClass("on");
    testWebsocket = null;
    onRepeat();
    writeToScreen("DISCONNECTED");
    settings.onClose && settings.onClose();
  }

  function onMessage(evt) {
    try {
      evt = JSON.parse(evt.data);
      writeToScreen("<span style='color: blue;'>RESPONSE: " + evt + "</span>");
      // console.log("RESPONSE", JSON.stringify(evt));
      var noError = settings.checkError && settings.checkError(evt) === false;
      if (noError) {
        settings.onMessage && settings.onMessage(evt);
      } else {
        onError(evt);
      }
    } catch(e) {
    }

  }

  function onError(evt) {
    writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data);
  }

  function writeToScreen(message) {
    settings.chatOpen && output.append($("<p/>").html(message));
  }

  ws_ctx.chatOff = function() {
    settings.chatOpen = false;
    output.html("<i>Чат отключен. Сообщений нет.</i>");
  };

  ws_ctx.chatOn = function() {
    output.html("");
    settings.chatOpen = true;
  };

  websocket = createWebsocket();
}

function RequestTable() {
  var table = {}, keys = []; //free keys

  function generateKey() {
    var k;
    if (keys.length > 0) {
      k = keys.shift();
    } else {
      k = 1;
      while (Object.keys(table).indexOf(k.toString()) != -1)
        k++;
    }
    return k;
  }

  this.set = function(func) {
    if (!func) {
      console.error("WebSocket did't send. No callback function.");
      return -1;
    }
    var k = generateKey();
    table[k] = func;
    return k;
  };

  this.get = function(k, param) {
    if (!table[k]) {
      console.error("Don't have function for this socket");
      return -1;
    }
    table[k](param);
    delete table[k];
    keys.push(k);
  };

  this.size = function() {
    return Object.keys(table);
  };

  this.commandList = {
    CONNECT: 0,
    CONNECTED: 1,
    CALL: 8,
    EVENT: 13,
    SUBSCRIBE: 16,
    UNSUBSCRIBE: 18
  };
}

var tableCall = new RequestTable();

$(document).ready(function() {
  var ws = new Socket({
    chatOpen: false,
	uri: "ws://" + window.location.hostname + ":3000/ws/",
    //uri: "ws://192.168.0.148:3000/ws/",
    onMessage: function(msg) {
      var isEvent = msg[0] === tableCall.commandList.EVENT;
      if (isEvent) {
        var eventType = msg[2], eventArgs = msg[3];
        events[eventType](eventArgs);
      } else {
        tableCall.get(msg[1], msg[2]);
      }
    },
    checkError: function(msg) {
      return msg[1] === 5;
    },
    onOpen: function() {
      subscribeStat();
    },
    onClose: function() {
      console.error("Отключились :(");
      unsubscribeStat();
      // $no_connection.modal("show");
    }
  });

  /* WIDGETS */
  var getRadiusGauge = function() {
    return Math.max(window.innerWidth / 2 / 2 / 6, 30)
  };

  var gaugeSettings = {
    radius:              getRadiusGauge(),
    maxValue:            100,
    width:               3,
    colors:              ['#1d6c74','#3dfcfa'],
    duration:            400,
    wrpClass:            'circles-wrp',
    textClass:           'circles-text',
    valueStrokeClass:    'circles-valueStroke',
    maxValueStrokeClass: 'circles-maxValueStroke',
    styleWrapper:        true,
    styleText:           true
  };

  var memGauge = Circles.create(Object.assign({}, {
    id: 'mem-circle',
    text: function(value) { return value + '%' }
  }, gaugeSettings));
  var vinGauge = Circles.create(Object.assign({}, {
    id: 'vin-circle',
    text:function(value) { return value }
  }, gaugeSettings));
  var cpuGauge = Circles.create(Object.assign({}, {
    id: 'cpu-circle',
    text:function(value) { return value + '%' }
  }, gaugeSettings));

  window.onresize = function(e) {
    var r = getRadiusGauge();
    memGauge.updateRadius(r);
    vinGauge.updateRadius(r);
    cpuGauge.updateRadius(r);
  };


  var $stat = $(".log");

  var events = {
    'stat': function(stat) {
      if(!stat) {
        return ;
      }
      // $stat.html(JSON.stringify(stat, null, '  '));
      // memCircle.set(stat.freemem/stat.mem*100); // set actual value
      memGauge.update(~~(stat.freemem / stat.mem * 100));
      vinGauge.update(stat.Vin);
      cpuGauge.update(~~(stat.usage.system / 1000000));
    }
  }

  function sendPosition(position, clb) {
    ws.doSend([tableCall.commandList.CALL, tableCall.set(function(pos) {
      clb && clb();
    }), "position", [position.x, position.y]]);
  }

  function sendArm(position, clb) {
    ws.doSend([tableCall.commandList.CALL, tableCall.set(function(pos) {
      clb && clb();
    }), "arm", [position.x, position.y]]);
  }

  function subscribeStat(clb) {
      ws.doSend([tableCall.commandList.SUBSCRIBE, tableCall.set(function(pos) {
          console.log("%c SUBSCRIBE stat", "color: blue");
          isStatSubscribed = true;
          clb && clb();
      }), "stat", []]);
  }

  function unsubscribeStat(clb) {
      ws.doSend([tableCall.commandList.UNSUBSCRIBE, tableCall.set(function(pos) {
          console.log("%c UNSUBSCRIBE stat", "color: blue");
          isStatSubscribed = false;
          clb && clb();
      }), "stat", []]);
  }

  function throttle(func, ms) {
    var isThrottled = false,
      savedArgs,
      savedThis;

    function wrapper() {
      if (isThrottled) { // (2)
        savedArgs = arguments;
        savedThis = this;
        return;
      }

      func.apply(this, arguments); // (1)

      isThrottled = true;

      setTimeout(function() {
        isThrottled = false; // (3)
        if (savedArgs) {
          wrapper.apply(savedThis, savedArgs);
          savedArgs = savedThis = null;
        }
      }, ms);
    }

    return wrapper;
  }

  /* JOYSTICK */
  var debounceSetPositon = throttle(sendPosition, 40);
  var debounceSetArm = throttle(sendArm, 40);

  var positionJoystick = nipplejs.create({
    zone: document.getElementById("position-joystick"),
    mode: "static",
    // position: { left: "20%", top: "70%" },
    position: { left: "50%", top: "-50%" },
    color: "#3dfcfa"
  });

  positionJoystick
    .on("move", function(evt, data) {
      debounceSetPositon(data.instance.frontPosition);
    })
    .on("end", function(evt, data) {
      debounceSetPositon({x: 0, y: 0});
    });

  var armJoystick = nipplejs.create({
    zone: document.getElementById("arm-joystick"),
    mode: "static",
    position: { right: "50%", top: "-50%" },
    color: "#3dfcfa"
  });

  armJoystick
    .on("move", function(evt, data) {
      debounceSetArm(data.instance.frontPosition);
    })
    .on("end", function(evt, data) {
      debounceSetArm({x: 0, y: 0});
    });

  /* CLOCK */
  var $day = $('#current-day'),
      $month = $('#current-month'),
      $time = $('#current-time');

  function startTime() {
      var today = new Date();
      var h = today.getHours();
      var m = today.getMinutes();
      var s = today.getSeconds();
      var d = today.getDate();//.getDay();
      var mouth = today.toLocaleString("ru", { month: "long" });
      m = checkTime(m);
      s = checkTime(s);

      $time.html(h + ":" + m);
      $day.html(d);
      $month.html(mouth);

      var t = setTimeout(startTime, 2000);
  }

  function checkTime(i) {
      if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
      return i;
  }

  startTime();

});
</script>
</body>
</html>
